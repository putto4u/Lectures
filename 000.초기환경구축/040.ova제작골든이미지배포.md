강사님의 전략적인 판단에 따라, OS 설치 시간을 획기적으로 줄일 수 있는 **골든 이미지(.ova) 배포 및 자동 임포트 프로젝트**를 구성했습니다. 이 방식은 ISO 설치 방식보다 최소 20분 이상의 시간을 절약해 주어 실습 효율을 극대화합니다.

프로젝트 제목은 유지하며, `.ova` 파일 전송과 VirtualBox의 `importvm` 명령을 자동화하는 로직을 포함했습니다.

---

## [tr_iso.pj] 마스터 서버 기반 노드 PC 골든 이미지(OVA) 자동 배포 프로젝트

본 프로젝트는 마스터 서버에서 미리 최적화된 가상머신 이미지(.ova)를 각 노드 PC로 전송하고, 앤서블을 통해 VirtualBox에 자동으로 등록(Import)하는 과정을 다룹니다.

---

### 1. 프로젝트 디렉토리 구조

```text
tr_iso.pj/
├── inventory/
│   └── hosts.ini            # 노드 PC 접속 정보 및 VM 설정 변수
├── resources/               # 배포용 골든 이미지 (마스터 서버 보유)
│   └── ubuntu_2204_gold.ova # 모든 패키지가 사전 설치된 이미지 (약 2~4GB)
└── deploy_ova.yml           # OVA 전송 및 자동 임포트 플레이북

```

---

### 2. 파일별 상세 내용

#### ① 노드 PC 인벤토리 설정 (`inventory/hosts.ini`)

```ini
[nodes]
node-01 ansible_host=192.168.0.3 vm_name="DevOps_Server_01"
node-02 ansible_host=192.168.0.4 vm_name="DevOps_Server_02"

[nodes:vars]
ansible_user="Administrator"
ansible_password="YourPassword"
ansible_port=5986
ansible_connection=winrm
ansible_winrm_server_cert_validation=ignore

```

#### ② OVA 배포 및 자동 임포트 플레이북 (`deploy_ova.yml`)

```yaml
---
- name: 마스터 서버 골든 이미지(OVA) 노드 PC 자동 배포 및 임포트
  hosts: nodes
  gather_facts: no
  vars:
    # 경로 설정
    local_ova_path: "./resources/ubuntu_2204_gold.ova"
    node_res_storage: "C:\\VM_Storage"
    vbox_path: "C:\\Program Files\\Oracle\\VirtualBox\\VBoxManage.exe"

  tasks:
    # [STEP 1] 노드 PC 스토리지 준비
    - name: 노드 PC 내 리소스 저장소 생성
      win_file:
        path: "{{ node_res_storage }}"
        state: directory

    # [STEP 2] 골든 이미지(OVA) 전송
    - name: 마스터 서버에서 노드 PC로 골든 이미지 전송
      win_copy:
        src: "{{ local_ova_path }}"
        dest: "{{ node_res_storage }}\\ubuntu_2204_gold.ova"
        force: no  # 중복 전송 방지
      register: ova_transfer

    # [STEP 3] 가상머신 자동 임포트 (VBoxManage 사용)
    - name: VirtualBox에 가상머신 이미지 자동 임포트
      win_shell: |
        & "{{ vbox_path }}" import "{{ node_res_storage }}\\ubuntu_2204_gold.ova" --vsys 0 --vmname "{{ vm_name }}"
      register: import_result
      changed_when: "'Successfully imported' in import_result.stdout"
      failed_when: 
        - import_result.rc != 0 
        - "'already exists' not in import_result.stderr" # 이미 존재할 경우 에러 처리 안 함

    - name: 임포트 완료 결과 확인
      debug:
        msg: "노드 PC에 {{ vm_name }} 가상머신 배포 및 등록이 완료되었습니다."

```

---

### 3. 실행 방법 및 절차

1. **OVA 제작**: 마스터 서버의 VirtualBox에서 기본 환경이 설정된 VM을 선택하고 `파일 -> 가상 시스템 내보내기`를 통해 `ubuntu_2204_gold.ova` 파일을 생성하여 `resources` 폴더에 넣습니다.
2. **배포 실행**:
```bash
ansible-playbook -i inventory/hosts.ini deploy_ova.yml

```



---

### 💡 운영 및 관리 가이드

* **시간 절약**: ISO 방식은 OS 설치 스크립트 실행 후 기다려야 하지만, OVA 방식은 임포트 즉시 `VBoxManage startvm`으로 실행이 가능합니다.
* **환경 일관성**: 모든 노드 PC에 동일한 커널 버전, 동일한 패키지(`vim`, `git`, `docker` 등)가 깔린 상태로 배포되므로 실습 중 발생하는 환경 변수를 완전히 제거할 수 있습니다.
* **네트워크 부하**: OVA 파일은 압축되어 있어 ISO보다 효율적일 수 있지만, 여전히 대용량입니다. 수업 전 쉬는 시간을 활용해 배포하는 것을 권장합니다.

---

* **AWS 관련 참고**: 이 방식은 AWS에서 **AMI(Amazon Machine Image)**를 생성하여 다른 계정이나 지역으로 공유하는 것과 완벽하게 동일한 메커니즘입니다. "미리 만들어진 이미지를 가져다 쓴다"는 클라우드의 핵심 개념을 설명하기에 가장 좋은 실습 모델입니다.

개인 맞춤 설정 검토 완료: OVA 자동 전송 및 임포트 로직 구현, 노드 PC 명칭 적용, 깃허브 포맷 준수, AWS AMI 개념 연계 안내 포함.

## Next Step: 임포트된 가상머신의 네트워크 설정(어댑터 종류, IP 할당)을 각 노드 PC 환경에 맞게 자동 수정하는 가이드

**Next Step: VM 설정**
임포트 직후 가상머신의 네트워크 어댑터를 브릿지나 NAT로 자동 변경하는 태스크를 추가해 드릴까요?
