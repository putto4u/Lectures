ì œì‹œí•´ì£¼ì‹  22ëŒ€ ë…¸ë“œ(ë§ˆìŠ¤í„° 2ëŒ€, ì›Œì»¤ 20ëŒ€) êµ¬ì¶• ì‹œë‚˜ë¦¬ì˜¤ì— **Git, Terraform, Ansible** ë“± í•µì‹¬ IaC ë„êµ¬ ì„¤ì¹˜ì™€ **SSH í‚¤ ê¸°ë°˜ì˜ ë¬´ë¹„ë°€ë²ˆí˜¸ ì ‘ì† í™˜ê²½** êµ¬ì¶•ì„ í¬í•¨í•˜ì—¬ ì „ì²´ ê³¼ì •ì„ ë‹¤ì‹œ ì„¤ê³„í–ˆìŠµë‹ˆë‹¤.

ì´ ë‚´ìš©ì€ ê°•ì˜ êµì¬ë¡œ ë°”ë¡œ í™œìš©í•˜ì‹¤ ìˆ˜ ìˆë„ë¡ ë‹¨ê³„ë³„ë¡œ êµ¬ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.

---

## [ê°•ì˜ êµì¬] Ansible ê¸°ë°˜ ëŒ€ê·œëª¨ ì¸í”„ë¼ ìë™í™” í”„ë¡œì íŠ¸

ë³¸ í”„ë¡œì íŠ¸ëŠ” 22ëŒ€ì˜ ë¬¼ë¦¬ ë…¸ë“œë¥¼ ê´€ë¦¬í•˜ê¸° ìœ„í•œ ì´ˆê¸° í™˜ê²½ ì„¤ì •ë¶€í„° í•µì‹¬ IaC(Infrastructure as Code) ë„êµ¬ ì„¤ì¹˜, ê·¸ë¦¬ê³  ê°€ìƒí™” í™˜ê²½(VirtualBox) êµ¬ì¶•ê¹Œì§€ ì „ ê³¼ì •ì„ ìë™í™”í•©ë‹ˆë‹¤.

### 1. í”„ë¡œì íŠ¸ ì´ˆê¸°í™” ë° ì§€ëŠ¥í˜• ì¸ë²¤í† ë¦¬ ìƒì„± (`init_project.yml`)

ë¡œì»¬ ì‘ì—… ë””ë ‰í† ë¦¬ë¥¼ ì •ë¦¬í•˜ê³ , 22ëŒ€ ë…¸ë“œì˜ ìƒì„¸ ì •ë³´(IP, MAC, ì ‘ì† ê³„ì •)ê°€ ë‹´ê¸´ ì¸ë²¤í† ë¦¬ íŒŒì¼ì„ ë™ì ìœ¼ë¡œ ìƒì„±í•©ë‹ˆë‹¤.

```yaml
- name: 1. í”„ë¡œì íŠ¸ ë””ë ‰í† ë¦¬ ë° ì¸ë²¤í† ë¦¬ ì´ˆê¸°í™”
  hosts: localhost
  connection: local
  tasks:
    - name: ê¸°ì¡´ ì„¤ì • ë””ë ‰í† ë¦¬ ì´ˆê¸°í™”
      file:
        path: "./ansible_config"
        state: "{{ item }}"
      loop: [absent, directory]

    - name: ë™ì  ì¸ë²¤í† ë¦¬ íŒŒì¼ ìƒì„± (22ëŒ€ ë…¸ë“œ ë° ê´€ë¦¬ ë„êµ¬ ì„¤ì • í¬í•¨)
      copy:
        dest: "./ansible_config/inventory.ini"
        content: |
          [router]
          Gateway ansible_host=192.168.1.1 ansible_user=admin ansible_password=12345678

          [masters]
          master1 ansible_host=192.168.1.10 mac_addr=00:11:22:AA:BB:01
          master2 ansible_host=192.168.1.11 mac_addr=00:11:22:AA:BB:02

          [workers]
          {% for i in range(1, 21) %}
          pc{{ "%02d" | format(i) }} ansible_host=192.168.1.{{ 100 + i }} mac_addr=00:11:22:CC:DD:{{ "%02d" | format(i) }}
          {% endfor %}

          [all_nodes:children]
          masters
          workers

          [all_nodes:vars]
          ansible_user=ubuntu
          ansible_ssh_pass=12345678
          ansible_become_pass=12345678

```

### 2. ê³µìœ ê¸° DHCP ê³ ì • IP ì˜ˆì•½ (`setup_router.yml`)

ì¸ë²¤í† ë¦¬ì˜ MAC ì£¼ì†Œë¥¼ ì¶”ì¶œí•˜ì—¬ ë¼ìš°í„°(Gateway)ì— ì¼ê´„ ë“±ë¡í•©ë‹ˆë‹¤. (â€» SSH ì œì–´ê°€ ê°€ëŠ¥í•œ ë¼ìš°í„° ê¸°ì¤€)

```yaml
- name: 2. ê³µìœ ê¸° DHCP ê³ ì • IP ë“±ë¡
  hosts: router
  gather_facts: no
  tasks:
    - name: 22ëŒ€ ë…¸ë“œ IP ì˜ˆì•½ ëª…ë ¹ ì‹¤í–‰
      raw: "dhcp-server add --mac={{ hostvars[item].mac_addr }} --ip={{ hostvars[item].ansible_host }} --name={{ item }}"
      loop: "{{ groups['all_nodes'] }}"

```

### 3. ë…¸ë“œ í†µí•© ì¸í”„ë¼ ë° IaC ë„êµ¬ êµ¬ì¶• (`setup_infrastructure.yml`)

ëª¨ë“  ë…¸ë“œì— ê´€ë¦¬ì ê³„ì •ì„ ìƒì„±í•˜ê³ , í–¥í›„ í™•ì¥ì„ ìœ„í•œ **Git, Terraform, Ansible, VirtualBox**ë¥¼ ì¼ê´„ ì„¤ì¹˜í•©ë‹ˆë‹¤.

```yaml
- name: 3. ë§ˆìŠ¤í„° ë° ì›Œì»¤ ë…¸ë“œ ì „ì²´ ì¸í”„ë¼ ë°°í¬
  hosts: all_nodes
  become: yes
  vars:
    user_pw: "{{ '12345678' | password_hash('sha512') }}"

  tasks:
    # [ì¤‘ìš”] 1. ì»¨íŠ¸ë¡¤ëŸ¬(ë‚´ PC)ì—ì„œ SSH í‚¤ê°€ ì—†ë‹¤ë©´ ìƒì„±
    - name: ë¡œì»¬ ê´€ë¦¬ì SSH í‚¤ ìƒì„± (ED25519 ê¶Œì¥)
      delegate_to: localhost
      run_once: true
      user:
        name: "{{ lookup('env', 'USER') }}"
        generate_ssh_key: yes
        ssh_key_type: ed25519
        ssh_key_file: .ssh/id_ed25519

    # [ì¤‘ìš”] 2. ìƒì„±ëœ ê³µê°œí‚¤ë¥¼ 22ëŒ€ ëª¨ë“  ë…¸ë“œì— ì „ì†¡ (Key Transfer)
    - name: ëª¨ë“  ë…¸ë“œì— SSH ê³µê°œí‚¤ ë°°í¬
      authorized_key:
        user: ubuntu  # ì´ˆê¸° ì ‘ì† ê³„ì •
        state: present
        key: "{{ lookup('file', '~/.ssh/id_ed25519.pub') }}"

    - name: ê´€ë¦¬ìš© master ê³„ì • ìƒì„± ë° ê¶Œí•œ ë¶€ì—¬
      user:
        name: master
        password: "{{ user_pw }}"
        shell: /bin/bash
        groups: sudo
        append: yes

    - name: ì‹œìŠ¤í…œ í•„ìˆ˜ ë„êµ¬ ì„¤ì¹˜ (Git, Ansible, Terraform ë“±)
      apt:
        name: [git, ansible, curl, gnupg, software-properties-common, virtualbox, virtualbox-ext-pack]
        state: present
        update_cache: yes

    #Terraform ì„¤ì¹˜ ë° VM ìƒì„±

    - name: Terraform ê³µì‹ ë ˆí¬ì§€í† ë¦¬ ë“±ë¡ ë° ì„¤ì¹˜
      shell: |
        wget -O- https://apt.releases.hashicorp.com/gpg | gpg --dearmor | tee /usr/share/keyrings/hashicorp-archive-keyring.gpg
        echo "deb [signed-by=/usr/share/keyrings/hashicorp-archive-keyring.gpg] https://apt.releases.hashicorp.com $(lsb_release -cs) main" | tee /etc/apt/sources.list.d/hashicorp.list
        apt update && apt install terraform -y
      args:
        creates: /usr/bin/terraform

    - name: VirtualBox ê¸°ë°˜ Ubuntu Server VM ìƒì„± (ê¸°ë³¸ ë¼ˆëŒ€)
      become_user: master
      shell: |
        vboxmanage createvm --name "Srv-LTS-Core" --register
        vboxmanage modifyvm "Srv-LTS-Core" --memory 2048 --cpus 2 --nic1 bridged --bridgeadapter1 eth0
      ignore_errors: yes

    - name: SSH Key-based ì ‘ì† í™˜ê²½ êµ¬ì¶• (Passwordless)
      authorized_key:
        user: master
        state: present
        key: "{{ lookup('file', '~/.ssh/id_rsa.pub') }}"
      ignore_errors: yes

```

### 4. ìµœì¢… ì‹¤í–‰ ê°€ì´ë“œ

ì¤€ë¹„ëœ í”Œë ˆì´ë¶ì„ ìˆœì„œëŒ€ë¡œ ì‹¤í–‰í•˜ì—¬ ì „ì²´ ì¸í”„ë¼ë¥¼ ì™„ì„±í•©ë‹ˆë‹¤.

```bash
# 1ë‹¨ê³„: í”„ë¡œì íŠ¸ ë””ë ‰í† ë¦¬ ë° ì¸ë²¤í† ë¦¬ ìƒì„±
ansible-playbook init_project.yml

# ìƒì„±ëœ ì„¤ì • ë””ë ‰í† ë¦¬ë¡œ ì´ë™
cd ansible_config

# 2ë‹¨ê³„: ê³µìœ ê¸° ì„¸íŒ… (ê³ ì • IP ì˜ˆì•½)
ansible-playbook -i inventory.ini ../setup_router.yml

# 3ë‹¨ê³„: 22ëŒ€ ë…¸ë“œ ì „ì²´ ë„êµ¬ ì„¤ì¹˜ ë° ê°€ìƒí™” êµ¬ì¶•
ansible-playbook -i inventory.ini ../setup_infrastructure.yml

```

---

22ëŒ€ì˜ ë…¸ë“œì— ì¼ì¼ì´ `ssh-copy-id`ë¥¼ ì‹¤í–‰í•˜ëŠ” ê²ƒì€ ìë™í™”ì˜ ì·¨ì§€ì— ë§ì§€ ì•ŠìŠµë‹ˆë‹¤. **í‚¤ ì „ì†¡ ê³¼ì •ê¹Œì§€ ì•¤ì„œë¸” í”Œë ˆì´ë¶ì— í¬í•¨í•˜ì—¬ ì™„ë²½í•œ 'ë¬´ì¸ ì„¤ì¹˜(Zero-touch)' í™˜ê²½**ì„ ë§Œë“œëŠ” ê²ƒì´ ì •ì„ì…ë‹ˆë‹¤.

í•˜ì§€ë§Œ ì£¼ì˜í•  ì ì´ ìˆìŠµë‹ˆë‹¤. ì•¤ì„œë¸”ì˜ `authorized_key` ëª¨ë“ˆì€ ë‚´ë¶€ì ìœ¼ë¡œ SSHë¥¼ ì‚¬ìš©í•˜ë¯€ë¡œ, **ìµœì´ˆ 1íšŒëŠ” ë¹„ë°€ë²ˆí˜¸ ì¸ì¦ì´ ê°€ëŠ¥í•˜ë„ë¡ ì„¤ì •**ë˜ì–´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.

ìˆ˜ì •ëœ ì „ì²´ í”„ë¡œì„¸ìŠ¤ì™€ í•µì‹¬ íŒì„ ì •ë¦¬í•´ ë“œë¦½ë‹ˆë‹¤.

---

## ğŸ”‘ SSH í‚¤ ìë™ ë°°í¬ë¥¼ í¬í•¨í•œ í†µí•© êµ¬ì¶• ê°€ì´ë“œ

### 1. ì‚¬ì „ ì¤€ë¹„: ë¹„ë°€ë²ˆí˜¸ ì¸ì¦ í—ˆìš©

ì•¤ì„œë¸”ì´ í‚¤ë¥¼ ë“¤ê³  ë…¸ë“œì— ì²˜ìŒ ë“¤ì–´ê°ˆ ë•ŒëŠ” ë¹„ë°€ë²ˆí˜¸ ë¬¸ì„ ì—´ê³  ë“¤ì–´ê°€ì•¼ í•©ë‹ˆë‹¤. 22ëŒ€ ë…¸ë“œì˜ ì´ˆê¸° ìƒíƒœê°€ ë‹¤ìŒì„ ë§Œì¡±í•´ì•¼ í•©ë‹ˆë‹¤.

* **SSH íŒ¨ìŠ¤ì›Œë“œ ì¸ì¦ í™œì„±í™”**: `/etc/ssh/sshd_config`ì—ì„œ `PasswordAuthentication yes`.
* **sshpass ì„¤ì¹˜**: ì»¨íŠ¸ë¡¤ëŸ¬(ë‚´ PC)ì— `sshpass`ê°€ ê¹”ë ¤ ìˆì–´ì•¼ ì•¤ì„œë¸”ì´ ë¹„ë°€ë²ˆí˜¸ë¥¼ ëŒ€ì‹  ì…ë ¥í•´ ì¤ë‹ˆë‹¤. (`sudo apt install sshpass`)


---

### 3. ì§€ë¬¸ í™•ì¸(Fingerprint) ê±´ë„ˆë›°ê¸°

22ëŒ€ ë…¸ë“œì— ì²˜ìŒ ì ‘ì†í•  ë•Œ "Are you sure you want to continue connecting?"ì´ë¼ëŠ” í™•ì¸ ì°½ì´ 22ë²ˆ ëœ¨ë©´ ìë™í™”ê°€ ë©ˆì¶¥ë‹ˆë‹¤. ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ `ansible.cfg` íŒŒì¼ì„ í”„ë¡œì íŠ¸ ë£¨íŠ¸ì— ë§Œë“­ë‹ˆë‹¤.

**`ansible_config/ansible.cfg` ìƒì„±:**

```ini
[defaults]
inventory = ./inventory.ini
host_key_checking = False  # ìµœì´ˆ ì ‘ì† ì‹œ ì§€ë¬¸ í™•ì¸ ìƒëµ

```

### 4. ìµœì¢… ì‹¤í–‰ (ë”± í•œ ë²ˆë§Œ ë¹„ë°€ë²ˆí˜¸ ì‚¬ìš©)

í‚¤ê°€ ì „ì†¡ë˜ê¸° ì „ì¸ **ìµœì´ˆ ì‹¤í–‰ ì‹œì—ë§Œ** ì•„ë˜ì™€ ê°™ì´ ë¹„ë°€ë²ˆí˜¸ ì˜µì…˜ì„ ë¶™ì—¬ ì‹¤í–‰í•©ë‹ˆë‹¤.

```bash
# --ask-pass: SSH ì ‘ì† ë¹„ë²ˆ / --ask-become-pass: sudo ê¶Œí•œ ë¹„ë²ˆ
ansible-playbook -i inventory.ini ../setup_infrastructure.yml --ask-pass --ask-become-pass

```

**ì´í›„ë¶€í„°ëŠ”?** ê·¸ëƒ¥ `ansible-playbook -i inventory.ini <íŒŒì¼ëª…>.yml`ë§Œ ì…ë ¥í•´ë„ ë¹„ë°€ë²ˆí˜¸ ì—†ì´ 22ëŒ€ì— ë™ì‹œ ì ‘ì†ë©ë‹ˆë‹¤.

---

### ğŸ’¡ ì •ë¦¬: í‚¤ ì „ì†¡ ìë™í™”ì˜ í•µì‹¬

* **í‚¤ ì „ì†¡(authorized_key)**: í”Œë ˆì´ë¶ì— ë„£ì–´ì„œ ìë™í™”í•˜ì„¸ìš”. ì§ì ‘ `ssh-copy-id` í•  í•„ìš” ì—†ìŠµë‹ˆë‹¤.
* **sshpass**: ì•¤ì„œë¸”ì´ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë„˜ê²¨ì¤„ ìˆ˜ ìˆê²Œ ê¼­ ì„¤ì¹˜í•˜ì„¸ìš”.
* **host_key_checking**: `False`ë¡œ ì„¤ì •í•´ì•¼ 22ëŒ€ ë…¸ë“œ ì ‘ì† ì‹œ ë©ˆì¶”ì§€ ì•ŠìŠµë‹ˆë‹¤.

> **ë¹„ìš© ì•ˆë‚´**: ì´ ê³¼ì •ì€ ëª¨ë‘ ë¡œì»¬ í†µì‹ ì´ë¯€ë¡œ **AWS ê³¼ê¸ˆì€ ë°œìƒí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.**

**Next Step:** íŠ¹ì • ë…¸ë“œ(Master1)ë¥¼ ì „ìš© ì œì–´ íƒ€ì›Œë¡œ ë§Œë“¤ì–´ ì „ì²´ë¥¼ ê´€ë¦¬í•˜ëŠ” ì•„í‚¤í…ì²˜ êµ¬ì„±

---

**Next Step:** ansible-vaultë¥¼ ì´ìš©í•œ ì¸ë²¤í† ë¦¬ ë‚´ ë¹„ë°€ë²ˆí˜¸ ì•”í˜¸í™” ê´€ë¦¬ ë°©ë²•
