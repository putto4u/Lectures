마스터 서버(PC)에서 가상화 소프트웨어(VirtualBox/VMware)와 우분투 VM을 생성하는 과정 역시 **Ansible**을 통해 자동화할 수 있습니다. 다만, 마스터 서버의 OS가 윈도우라면 몇 가지 준비 과정이 필요합니다.

---

## 마스터 서버(PC)를 활용한 가상 인프라 자동화 구축

일반적으로 수동으로 진행하는 가상 머신 생성 및 OS 설치 과정을 **IaC(Infrastructure as Code)** 개념을 도입하여 자동화할 수 있습니다. 마스터 서버(PC)를 관리자로 설정하고 코드 한 줄로 VM을 생성하는 구조를 설계합니다.

### 1. 자동화 아키텍처 구성

* **제어 노드 (Control Node):** 마스터 서버(PC). Ansible이 실행되는 주체입니다.
* **타겟 노드 (Managed Node):** 마스터 서버 내부의 하이퍼바이저(VirtualBox 등).
* **동작 원리:** 마스터 서버에서 Ansible 플레이북을 실행하면, 로컬에 설치된 VirtualBox의 API를 호출하여 VM을 생성하고 네트워크를 설정합니다.

---

### 2. 기술적 구현 방법

#### A. 가상화 소프트웨어 설치 자동화 (Chocolatey 활용)

윈도우 기반 마스터 서버(PC)에서는 **Chocolatey**라는 패키지 매니저를 Ansible과 연동하여 VirtualBox를 자동으로 설치할 수 있습니다.

```yaml
# VirtualBox 설치 예시 (Ansible Playbook)
- name: 마스터 서버에 VirtualBox 설치
  win_chocolatey:
    name: virtualbox
    state: present

```

#### B. VM 생성 및 우분투 배포 (Vagrant 병행 권장)

Ansible만으로 순수하게 VM의 ISO 하드웨어 설정부터 OS 내부 설정까지 진행하기에는 복잡도가 높습니다. 이때 **Vagrant**를 함께 사용하면 매우 효율적입니다.

1. **Vagrant:** VM의 사양(CPU, RAM, Network)과 베이스 이미지를 정의합니다.
2. **Ansible:** 생성된 VM 내부의 패키지 설치 및 보안 설정을 담당합니다.

```ruby
# Vagrantfile 예시 (VM 정의)
Vagrant.configure("2") do |config|
  config.vm.box = "ubuntu/jammy64" # 우분투 이미지 지정
  config.vm.provider "virtualbox" do |vb|
    vb.memory = "2048"
    vb.cpus = 2
  end
  # VM 생성 후 Ansible 자동 실행
  config.vm.provision "ansible" do |ansible|
    ansible.playbook = "setup.yml"
  end
end

```

---

### 3. 자동화 도입 시 고려사항

* **WinRM 설정:** 마스터 서버(PC)가 윈도우인 경우, Ansible이 자기 자신(Localhost)을 제어하기 위해 윈도우 원격 관리 서비스(WinRM)가 활성화되어 있어야 합니다.
* **VirtualBox SDK:** Ansible의 `community.general.virtualbox` 모듈을 사용하려면 마스터 서버에 관련 SDK와 파이썬 라이브러리가 설치되어야 합니다.

---

### 4. 환경별 장단점 비교

| 구분 | 수동 설치 (GUI) | Ansible + Vagrant 자동화 |
| --- | --- | --- |
| **속도** | 작업자 숙련도에 의존 | 초기 설정 후 반복 실행 시 압도적 빠름 |
| **정확성** | 설정 누락 및 실수 가능성 있음 | 코드대로 동일한 환경 무한 복제 가능 |
| **관리** | 기록이 남지 않음 | 코드가 곧 문서가 되어 이력 관리 가능 |

---

**비용 및 유료 서비스 안내**

* **소프트웨어:** 가상화를 위한 Ansible, Vagrant, VirtualBox는 모두 **무료**로 사용할 수 있는 오픈소스 도구입니다.
* **자원 소모:** 마스터 서버(PC)의 물리적 자원(RAM, SSD)을 사용하므로 클라우드 비용은 발생하지 않으나, 대량의 VM을 동시에 생성할 경우 마스터 서버의 성능 저하가 발생할 수 있습니다.

Next Step: 윈도우 마스터 서버용 Ansible 설치 가이드 / Vagrant와 VirtualBox 연동 실습 / VM 생성 후 Ansible을 이용한 초기 보안 설정

---

마스터 서버(PC)에서 매번 바뀌는 IP 주소를 효율적으로 관리하기 위해 시스템 설정 파일을 건드리지 않고, 프로젝트 폴더 내의 **앤서블 인벤토리(Ansible Inventory)** 파일을 활용하는 실습 환경 구축 가이드입니다.

---

## 프로젝트 중심의 IP 관리: Ansible Inventory 활용

실습실이나 유동 IP 환경에서는 서버의 주소가 수시로 변경됩니다. 이때 윈도우 시스템의 깊숙한 곳에 있는 `hosts` 파일을 수정하는 대신, 앤서블의 **인벤토리(Inventory)** 파일을 마스터 서버(PC)의 작업 폴더 내에서 관리함으로써 관리 효율성을 극대화할 수 있습니다.

### 1. 인벤토리(Inventory) 파일의 개념

인벤토리는 앤서블이 제어할 대상 서버들의 정보를 모아놓은 목록 파일입니다. 텍스트 형식(`.ini`)으로 작성하며, IP 주소뿐만 아니라 각 서버에 접속하기 위한 사용자 계정, 포트 번호 등을 별칭(Alias)과 함께 정의할 수 있습니다.

### 2. 프로젝트 폴더 구조 설정

마스터 서버(PC)의 작업 디렉토리를 다음과 같이 구성하여 모든 설정 파일이 한곳에 모이도록 합니다.

```text
C:\ansible-project\
├── inventory.ini      <-- 매일 IP를 수정할 파일
├── setup_vm.yml       <-- 실제 실행할 자동화 코드(Playbook)
└── ansible.cfg        <-- 인벤토리 경로를 지정하는 설정 파일

```

### 3. inventory.ini 파일 작성법

매일 아침 VM을 구동한 후 확인된 IP를 마스터 서버(PC)의 프로젝트 폴더 내 `inventory.ini` 파일에 다음과 같이 업데이트합니다.

```ini
# [그룹이름]
# 별칭(Alias)  연결할 실제 IP 주소  접속 계정 정보
[worker_vms]
worker-vm01  ansible_host=192.168.0.105  ansible_user=ubuntu
worker-vm02  ansible_host=192.168.0.106  ansible_user=ubuntu
worker-vm03  ansible_host=192.168.0.107  ansible_user=ubuntu

```

---

### 4. 인벤토리를 활용한 실습 워크플로우

1. **VM 가동:** 가상 머신(VM)을 실행하고 `ip addr` 명령으로 현재 IP를 확인합니다.
2. **인벤토리 수정:** 마스터 서버(PC)의 작업 폴더 내 `inventory.ini` 파일을 열어 확인된 IP로 수정합니다.
3. **연결 테스트:** 마스터 서버(PC)의 파워쉘에서 아래 명령을 입력하여 통신 여부를 확인합니다.
```powershell
ansible all -m ping -i inventory.ini

```


4. **자동화 실행:** IP 대신 `worker-vm01`과 같은 별칭을 사용하여 플레이북을 실행합니다.

### 5. 이 방식의 핵심 장점

* **시스템 안전성:** 마스터 서버(PC)의 윈도우 시스템 파일을 수정하지 않으므로 보안 위험이 적고 관리가 쉽습니다.
* **코드의 가독성:** YAML 파일 내부에서 복잡한 IP 대신 `worker_vms`라는 그룹 명칭을 사용할 수 있어 코드가 깔끔해집니다.
* **유연성:** 프로젝트별로 서로 다른 인벤토리 파일을 가질 수 있어 여러 실습 환경을 동시에 운영하기 유리합니다.

---

### [참고] 설정 자동화를 위한 ansible.cfg (선택 사항)

매번 `-i inventory.ini` 옵션을 붙이기 번거롭다면, 같은 폴더에 `ansible.cfg` 파일을 만들고 아래 내용을 넣으세요.

```ini
[defaults]
inventory = ./inventory.ini
host_key_checking = False  # 처음 접속 시 인증 확인 생략

```

---

**비용 및 유료 서비스 안내 (AWS)**

* **로컬 실습:** 인벤토리 파일을 이용해 로컬 VM을 제어하는 과정은 **완전 무료**입니다.
* **AWS 전환 시:** 만약 인벤토리의 `ansible_host`에 **AWS EC2의 탄력적 IP(EIP)**를 기재하여 작업할 경우, 인스턴스 사용 시간에 따른 **EC2 비용**이 발생합니다. (프리티어 `t2.micro` 권장)

Next Step: inventory.ini 그룹화 및 변수 설정 방법 / ansible.cfg 상세 설정 가이드 / SSH 키 기반 자동 접속 환경 구축

---

마스터 서버(PC)에서 시스템 경로 이동 없이 효율적으로 관리할 수 있는 최적의 교재 포맷으로 구성되었습니다. 깃허브 등에 바로 업로드하여 활용하시기 좋습니다.
