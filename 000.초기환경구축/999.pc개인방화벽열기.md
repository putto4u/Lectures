방화벽을 끄고 나서 핑(`ping`)이 된다는 것은 **네트워크 선은 물리적으로 잘 연결되어 있으나, Windows의 보안 정책이 앤서블의 접속을 막고 있었다**는 결정적인 증거입니다.

강의 교재에 들어갈 내용처럼 단계별로 정리해 드릴 테니, 보안을 위해 방화벽 전체를 끄는 대신 **앤서블 통신에 필요한 포트만 열어서** 문제를 해결해 보겠습니다.

---

## 1. 방화벽 문제 해결 전략

방화벽 전체를 끄는 것은 보안상 위험합니다. 대신 앤서블이 사용하는 **WinRM 포트**만 허용하는 규칙을 추가해야 합니다.

### ① 특정 포트 허용 (PowerShell 관리자 권한)

방화벽을 다시 켠 상태에서 아래 명령어를 입력하여 앤서블 전용 통로만 열어줍니다.

```powershell
# WinRM HTTP (5985) 및 HTTPS (5986) 포트 허용
netsh advfirewall firewall add rule name="Ansible_WinRM_In" dir=in action=allow protocol=TCP localport=5985,5986

```

### ② ICMP(Ping) 허용

핑 응답만 따로 허용하고 싶다면 아래 명령어를 사용합니다.

```powershell
netsh advfirewall firewall add rule name="ICMP_Allow" protocol=icmpv4:8,any dir=in action=allow

```

---

## 2. 최종 통신 확인 (win_ping)

방화벽 설정 후, 플레이북을 돌리기 전에 앤서블 서버에서 아래 명령어로 **'앤서블 전용 핑'**이 성공하는지 확인하세요.

```bash
# -m win_ping은 윈도우 전용 통신 점검 모듈입니다.
ansible pc-01 -i inventory/hosts.ini -m win_ping

```

**성공 시 출력 예시:**

```json
pc-01 | SUCCESS => {
    "changed": false,
    "ping": "pong"
}

```

`"ping": "pong"`이 나오면 이제 `site.yml` 플레이북을 실행할 준비가 모두 끝난 것입니다.

---

## 3. 요약 및 주의사항

* **네트워크 프로필**: 방화벽 규칙을 넣어도 네트워크가 **'공용(Public)'**이면 차단될 수 있습니다. 반드시 **'개인(Private)'**으로 유지하세요.
* **유료 서비스 알림 (AWS)**: 만약 AWS EC2 Windows 인스턴스를 사용 중이라면, OS 내부 방화벽 외에 AWS 콘솔의 **'Security Group(보안 그룹)'** 인바운드 규칙에도 5985, 5986 포트가 열려 있어야 합니다. (Bare Metal 인스턴스 사용 시 비용 주의)
* **파일 관리**: 현재 작업 중인 `inventory` 폴더나 `.ssh` 폴더는 `.gitignore`에 의해 보호되고 있으므로, 안심하고 커밋하셔도 됩니다.

---

**Next Step: `win_ping` 성공 후 VirtualBox 설치 및 VM 생성 단계 진행**

성공하셨다면 바로 플레이북을 실행해 보세요!
`ansible-playbook -i inventory/hosts.ini site.yml`
