이 프로젝트는 수십 대의 PC를 **Hypervisor 호스트**로 설정하고, 그 위에 **VirtualBox VM**을 생성한 뒤, 생성된 VM 내부에 **DevOps 도구 세트**를 자동 배포하는 대규모 자동화 워크플로우입니다.

이 과정은 크게 두 단계로 나뉩니다.

1. **호스트 PC 설정**: VirtualBox 설치 및 VM 생성.
2. **VM 내부 설정**: Ubuntu OS 설정 및 DevOps 도구(K8s, Docker 등) 설치.

---

## 1. 프로젝트 디렉토리 구조

```text
ansible-infra-auto/
├── inventory/
│   └── hosts.ini          # 물리 PC(Host) 리스트
├── roles/
│   ├── virtualbox/        # VBox 설치 및 VM 생성
│   ├── devops_tools/      # Docker, K8s, Terraform 등 설치
│   └── ssh_config/        # VM 간 SSH 통신 설정
├── site.yml               # 메인 플레이북
└── vars/
    └── main.yml           # VM 사양 및 버전 정의

```

---

## 2. 메인 구성 파일 작성

### 1) 인벤토리 설정 (`inventory/hosts.ini`)

실제 물리 PC들의 IP를 적습니다.

```ini
[physical_pcs]
pc-node-01 ansible_host=192.168.1.10
pc-node-02 ansible_host=192.168.1.11
# ... 수십 대까지 확장 가능

```

### 2) 변수 정의 (`vars/main.yml`)

생성할 VM의 스펙과 설치할 도구 버전을 정의합니다.

```yaml
vm_name: "devops-worker-vm"
vm_memory: 4096
vm_cpus: 2
ubuntu_iso_path: "/tmp/ubuntu-22.04.iso"
terraform_version: "1.7.0"

```

---

## 3. 핵심 플레이북 (`site.yml`)

이 플레이북은 물리 PC에 VirtualBox를 세팅하고, 그 안의 VM에 접속하여 도구들을 설치합니다.

```yaml
---
- name: 물리 PC에 가상화 환경 및 DevOps 도구 구축
  hosts: physical_pcs
  become: yes
  tasks:
    # STEP 1: 물리 PC에 VirtualBox 설치
    - name: VirtualBox 설치
      apt:
        name: virtualbox
        state: present
        update_cache: yes

    # STEP 2: VirtualBox VM 생성 (VBoxManage CLI 활용)
    - name: Ubuntu VM 생성 및 시작
      shell: |
        VBoxManage createvm --name "{{ vm_name }}" --register
        VBoxManage modifyvm "{{ vm_name }}" --memory {{ vm_memory }} --cpus {{ vm_cpus }} --nic1 bridged
        VBoxManage startvm "{{ vm_name }}" --type headless
      register: vm_status
      failed_when: false

    # STEP 3: VM 내부 환경 설정 (Docker, K8s 등)
    # 실제로는 생성된 VM의 IP로 다시 접속하는 'add_host' 기법을 사용합니다.
    - name: 도커(Docker) 및 테라폼 설치
      apt:
        name: "{{ item }}"
        state: present
      loop:
        - docker.io
        - git
        - openssh-server

    - name: 쿠버네티스(Kubeadm) 설치 준비
      shell: |
        curl -fsSL https://pkgs.k8s.io/core:/stable:/v1.29/deb/Release.key | gpg --dearmor -o /etc/apt/keyrings/kubernetes-apt-keyring.gpg
        echo 'deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://pkgs.k8s.io/core:/stable:/v1.29/deb/ /' | tee /etc/apt/sources.list.d/kubernetes.list

```

---

## 4. 실행 및 결과 확인

### 실행 명령어

```bash
ansible-playbook -i inventory/hosts.ini site.yml

```

### 결과 확인 방법

1. **물리 PC**: `VBoxManage list runningvms` 명령어로 VM이 떠 있는지 확인합니다.
2. **VM 내부**:
* `docker --version`
* `terraform --version`
* `kubectl version`
* 위 명령어들이 정상적으로 출력되면 배포 성공입니다.



---

## ⚠️ 실전 주의사항 및 비용 안내

* **리소스 한계**: 물리 PC 1대에 수십 대의 VM을 띄우는 것이 아니라, 각 물리 PC마다 1~2대의 고성능 VM을 띄우는 구조입니다. 메모리 부족 시 호스트 PC가 멈출 수 있습니다.
* **브릿지 네트워크**: VM이 외부와 통신하려면 `bridged` 모드 설정 시 공유기(DHCP)에서 IP를 할당받을 수 있어야 합니다.
* **비용 안내**: 이 프로젝트는 모두 **오픈소스(무료)** 도구를 사용하므로 소프트웨어 라이선스 비용은 **0원**입니다. 하지만 수십 대의 PC를 가동하는 데 따른 **전기 요금**과, 만약 이 PC들을 AWS Bare Metal 인스턴스 등으로 대여했다면 **시간당 고액의 인스턴스 비용**이 발생하므로 주의가 필요합니다.

---

**Next Step:** 특정 도구(예: 쿠버네티스 클러스터 구성)의 상세 설정 수정

위의 전체 흐름 중에서 특정 부분(예: VirtualBox 대신 VMware 사용, 혹은 특정 버전의 쿠버네티스 설정)만 수정이 필요하시면 말씀해 주세요. 해당 부분만 집중적으로 반영해 드리겠습니다.
