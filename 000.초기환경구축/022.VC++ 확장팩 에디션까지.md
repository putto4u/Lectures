## VirtualBox 및 DevOps 도구 통합 배포 프로젝트

Windows 호스트 PC를 대상으로 **Visual C++ 런타임**부터 **VirtualBox 확장팩**, 그리고 VM 내부의 **DevOps 도구 세트**까지 한 번에 구축하는 전체 프로젝트 구조와 파일 내용입니다.

---

### 1. 프로젝트 디렉토리 구조

```text
ansible-devops-project/
├── inventory/
│   └── hosts.ini            # 대상 Windows 호스트 PC 리스트
├── vars/
│   └── main.yml             # 설치 경로 및 버전 정보 변수
├── site.yml                 # 전체 공정을 제어하는 메인 플레이북
└── templates/
    └── vm_setup.ps1.j2      # VM 생성을 위한 PowerShell 템플릿

```

---

### 2. 파일별 상세 내용

#### ① 인벤토리 설정 (`inventory/hosts.ini`)

Windows PC 제어를 위해 `winrm` 관련 설정을 포함합니다.

```ini
[physical_pcs]
pc-01 ansible_host=192.168.1.10
pc-02 ansible_host=192.168.1.11

[physical_pcs:vars]
ansible_user=Administrator
ansible_password=YourPassword
ansible_connection=winrm
ansible_winrm_server_cert_validation=ignore

```

#### ② 변수 정의 (`vars/main.yml`)

설치에 필요한 URL과 VM 사양을 정의합니다.

```yaml
# 선행 필수 소프트웨어
vcredist_url: "https://aka.ms/vs/17/release/vc_redist.x64.exe"

# VirtualBox 관련
vbox_installer_url: "https://download.virtualbox.org/virtualbox/7.0.12/VirtualBox-7.0.12-159484-Win.exe"
ext_pack_url: "https://download.virtualbox.org/virtualbox/7.0.12/Oracle_VM_VirtualBox_Extension_Pack-7.0.12.vbox-extpack"
ext_pack_hash: "33d7284dc4a0ece278f985c002b881fd92b35887955e59824e5c0162dbf03d60"

# 생성할 VM 사양
vm_name: "DevOps-Master-VM"
vm_memory: 4096
vm_cpus: 2

```

#### ③ 메인 플레이북 (`site.yml`)

선행 조건(VC++)부터 최종 도구 배포까지의 워크플로우를 정의합니다.

```yaml
---
- name: Windows 호스트 가상화 및 DevOps 도구 통합 구축
  hosts: physical_pcs
  vars_files:
    - vars/main.yml

  tasks:
    # [STEP 1] Visual C++ 런타임 설치 (VBox 설치 필수 조건)
    - name: Microsoft Visual C++ Redistributable 설치
      win_package:
        path: "{{ vcredist_url }}"
        arguments: /install /quiet /norestart
        state: present

    # [STEP 2] VirtualBox 본체 설치
    - name: VirtualBox 소프트웨어 설치
      win_package:
        path: "{{ vbox_installer_url }}"
        arguments: /s
        state: present

    # [STEP 3] 확장팩(Extension Pack) 설치
    - name: 확장팩 다운로드
      win_get_url:
        url: "{{ ext_pack_url }}"
        dest: 'C:\Temp\VBoxExtPack.vbox-extpack'

    - name: 확장팩 라이선스 승인 및 설치
      win_shell: |
        $vboxManage = "${env:ProgramFiles}\Oracle\VirtualBox\VBoxManage.exe"
        & $vboxManage extpack install --replace --accept-license={{ ext_pack_hash }} 'C:\Temp\VBoxExtPack.vbox-extpack'
      ignore_errors: yes

    # [STEP 4] VM 생성 및 내부 도구 배포 (PowerShell 스크립트 실행)
    - name: Ubuntu VM 생성 및 DevOps 도구(Docker, K8s, Terraform) 배포
      win_shell: |
        # VM 생성 및 네트워크 설정
        VBoxManage createvm --name "{{ vm_name }}" --register
        VBoxManage modifyvm "{{ vm_name }}" --memory {{ vm_memory }} --cpus {{ vm_cpus }} --nic1 bridged
        
        # 실제 환경에서는 VM 내부 SSH 접속 후 아래 도구들을 설치하는 로직이 이어집니다.
        # (예시: Git, Docker, Terraform, Kubernetes 설치 명령 전달)
        VBoxManage startvm "{{ vm_name }}" --type headless

    - name: 설치 완료 확인
      debug:
        msg: "호스트 PC에 VirtualBox 및 {{ vm_name }} 구축이 완료되었습니다."

```

---

### 3. 실행 및 결과 확인

1. **프로젝트 실행**:
```bash
ansible-playbook -i inventory/hosts.ini site.yml

```


2. **단계별 검증**:
* **VC++**: 제어판 > 프로그램 및 기능에서 설치 확인.
* **VirtualBox**: `VBoxManage -v` 명령어로 버전 확인.
* **Extension Pack**: `VBoxManage list extpacks` 명령어로 활성화 확인.
* **VM**: `VBoxManage list runningvms` 명령어로 생성된 VM 구동 확인.



---

### ⚠️ 인프라 운영 및 비용 참고

* **AWS 사용 시**: Windows Server 인스턴스를 호스트로 사용할 경우, **중첩 가상화(Nested Virtualization)**를 지원하는 `metal` 인스턴스 기종을 선택해야 VirtualBox 내에서 VM이 정상 작동합니다. 일반 인스턴스보다 **비용이 월등히 높으므로** 실습 후에는 즉시 삭제하십시오.
* **라이선스**: VirtualBox 확장팩의 상업적 이용 시 라이선스 정책을 준수해야 합니다.

**Next Step:** VM 내부 상세 프로비저닝(SSH 연동) 방법

위 프로젝트 구조를 기반으로 하여, 생성된 VM 내부로 직접 들어가서 쿠버네티스 클러스터를 초기화하는 세부 단계가 필요하시면 말씀해 주세요. 전체 구조에 반영하여 다시 작성해 드리겠습니다.
